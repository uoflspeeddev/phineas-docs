<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submitting batch jobs &mdash; phineas-docs  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ansys" href="../software/index.html" />
    <link rel="prev" title="Starting an interactive job" href="interactive_jobs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            phineas-docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/index.html">HPC system overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/index.html#quickstart">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jobs</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Slurm</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="interactive_jobs.html">Starting an interactive job</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive_jobs.html#keeping-an-interactive-job-alive">Keeping an interactive job alive</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Submitting batch jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slurm-environmental-variables">Slurm environmental variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-environmental-variables">Other environmental variables</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Ansys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html#matlab">Matlab</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">phineas-docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Slurm</a></li>
      <li class="breadcrumb-item active">Submitting batch jobs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/jobs/batch_jobs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="submitting-batch-jobs">
<span id="batch-job"></span><h1>Submitting batch jobs<a class="headerlink" href="#submitting-batch-jobs" title="Link to this heading"></a></h1>
<p>The command <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> serves as the means to submit batch jobs to Slurm,
typically in the form of a shell script written in the bash command language.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A shell script is essentially a text file containing instructions
that are parsed and executed by a shell or command-line interpreter.</p>
</div>
<p>When submitting a job to Slurm, the shell script must adhere to the following requirements:</p>
<ol class="arabic">
<li><p>The first line of the script should specify the shell to be used.
This is accomplished by including a shebang (<code class="docutils literal notranslate"><span class="pre">#!</span></code>) followed by <code class="docutils literal notranslate"><span class="pre">/bin/env</span></code>, a space,
and the name of the desired shell. For example, for a bash script: <code class="docutils literal notranslate"><span class="pre">#!/bin/env</span> <span class="pre">bash</span></code>.
Alternatively, the path to the shell can be used directly: <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code>.</p></li>
<li><p>The script should define a set of parameters in the form of comments
(lines preceded by the <code class="docutils literal notranslate"><span class="pre">#</span></code> symbol). These parameters are utilized by Slurm
to establish job priority and resource requirements. Each parameter should begin
with the word <code class="docutils literal notranslate"><span class="pre">SBATCH</span></code> and should be placed on its own separate line. For instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/env bash</span>
<span class="c1">#SBATCH --job-name=some_job_name</span>
<span class="c1">#SBATCH --time=01:00</span>
</pre></div>
</div>
</li>
</ol>
<p>A list of common sbatch options is provided below for convenience:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Common sbatch options</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 36%" />
<col style="width: 23%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
<th class="head"><p><strong>Mandatory</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-J,</span> <span class="pre">--job-name</span></code></p></th>
<td><p>A user defined name assigned to the job</p></td>
<td><p>Any combination of letters and numbers</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-t,</span> <span class="pre">--time</span></code></p></th>
<td><p>Maximum time the job will be allowed to run</p></td>
<td><p>Time given in format: DD-HH:MM:SS</p></td>
<td><p><strong>YES</strong></p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--mem</span></code></p></th>
<td><p>Amount of memory the job requires per <strong>node</strong></p></td>
<td><p>&lt;number&gt;[units], where units are K for kilobytes, M for megabytes, G for gigabytes or T for terabytes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-n,</span> <span class="pre">--ntasks</span></code></p></th>
<td><p>Number of tasks of the job</p></td>
<td><p>Number</p></td>
<td><p>no (default 1)</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--ntasks-per-node</span></code></p></th>
<td><p>Number of tasks assigned to a node</p></td>
<td><p>Number</p></td>
<td><p>no (default 1)</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-N,</span> <span class="pre">--nodes</span></code></p></th>
<td><p>Number of nodes requested</p></td>
<td><p>Number</p></td>
<td><p>no (default 1)</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-c,</span> <span class="pre">--cpus-per-task</span></code></p></th>
<td><p>Number of threads per task</p></td>
<td><p>Number</p></td>
<td><p>no (default 1)</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">-p,</span> <span class="pre">--partition</span></code></p></th>
<td><p>Partition/queue where the job will be submited</p></td>
<td><p>longjobs or gpgpu</p></td>
<td><p><strong>YES</strong></p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--output</span></code></p></th>
<td><p>File where the standard output will be written</p></td>
<td><p>Any combination of letters and numbers</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--error</span></code></p></th>
<td><p>File where the standard error will be written</p></td>
<td><p>Any combination of letters and numbers</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--exclusive</span></code></p></th>
<td><p>The job cannot share nodes with other running jobs</p></td>
<td><p>No values</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">--test-only</span></code></p></th>
<td><p>Return an estimate of when a job would be run</p></td>
<td><p>No values</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>For more comprehensive details, please consult
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html">Slurm’s sbatch manual</a>.</p>
<p>Once the necessary parameters have been incorporated into the script,
users should proceed to configure the environment for the application they intend to execute.
If the job uses a software installed within the cluster,
users are encouraged to load the corresponding modulefiles within the script using
the <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">&lt;modulefile&gt;</span></code> command.
Alternatively, users can load their custom modulefiles or manually set
the required environmental variables.
Any additional tasks such as directory or file creation, among others,
should be performed at this stage. Note that the submission script
essentially functions as a shell script with additional comments at the beginning.
As such, any actions that a user would typically carry out in a regular shell session
can be executed within the script.</p>
<p>Finally, the script should encompass the core job tasks,
which typically involve executing simulations, experiments, or other relevant operations.
During this phase, users would typically initiate the necessary scientific software required
for their specific needs.</p>
<p><strong>Example:</strong> Consider the following bash script that defines a
job named 2d_driven_cavity_flow:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example bash script to launch a batch job</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="c1">#!/bin/bash</span>
<span class="w"> </span><span class="c1">#SBATCH --job-name=2d_driven_cavity_flow</span>
<span class="w"> </span><span class="c1">#SBATCH --error=/home/user/2d_driven_cavity_flow.err.%j</span>
<span class="w"> </span><span class="c1">#SBATCH --output=/home/user/2d_driven_cavity_flow.out.%j</span>
<span class="w"> </span><span class="c1">#SBATCH --time=05:30:00</span>
<span class="w"> </span><span class="c1">#SBATCH --ntasks=16</span>
<span class="w"> </span><span class="c1">#SBATCH --nodes=1</span>
<span class="w"> </span><span class="c1">#SBATCH --partition=longjobs</span>

<span class="w"> </span><span class="c1"># START CONFIGURING ENVIRONMENT</span>

<span class="w"> </span><span class="c1"># load Ansys 2023R1 modulefile</span>
<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>ansys/2023r1
<span class="w"> </span><span class="c1"># Generate list of hosts where ansys processes</span>
<span class="w"> </span><span class="c1"># will run</span>
<span class="w"> </span><span class="nv">HOSTLIST</span><span class="o">=</span><span class="s2">&quot;hosts.</span><span class="nv">$SLURM_JOB_ID</span><span class="s2">&quot;</span>
<span class="w"> </span>srun<span class="w"> </span>hostname<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$HOSTLIST</span>

<span class="w"> </span><span class="c1"># FINISHED CONFIGURING ENVIRONMENT</span>

<span class="w"> </span><span class="c1"># Run Fluent</span>
<span class="w"> </span>fluent<span class="w"> </span>3ddp<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-g<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-mpi<span class="o">=</span>openmpi<span class="se">\</span>
<span class="w">     </span>-t<span class="w"> </span><span class="nv">$SLURM_NTASKS</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-cnf<span class="o">=</span><span class="nv">$HOSTLIST</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-i<span class="w"> </span>/home/user/2d_driven_cavity_flow.jou<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>&gt;<span class="w"> </span>2d_driven_cavity_flow.out
</pre></div>
</div>
</div>
<p>In this script, the job is assigned the name <em>2d_driven_cavity_flow</em> using the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--job-name</span></code>
directive. The maximum allowed running time is set to 5 hours and 30 minutes through the
<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--time</span></code> directive. The job is configured to utilize 1 node (<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--nodes</span></code>)
and 16 processors (<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--ntasks</span></code>). It is intended to run in the <em>longjobs</em> queue
(<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--partition</span></code>). Any encountered error messages are to be stored in the file
<code class="docutils literal notranslate"><span class="pre">/home/user/2d_driven_cavity_flow.err.%j</span></code>, where <code class="docutils literal notranslate"><span class="pre">%j</span></code> is replaced with the job ID assigned by Slurm.
Similarly, non-error messages are directed to the file <code class="docutils literal notranslate"><span class="pre">/home/user/2d_driven_cavity_flow.out.%j</span></code>
for logging purposes. The environmental variables <code class="docutils literal notranslate"><span class="pre">SLURM_JOB_ID</span></code> and <code class="docutils literal notranslate"><span class="pre">SLURM_NTASKS</span></code> are passed
to the script by slurm (see section <a class="reference internal" href="#slurm-env-vars"><span class="std std-ref">Slurm environmental variables</span></a>).</p>
<p>Suppose this script is located at path: <code class="docutils literal notranslate"><span class="pre">/home/user/2d_driven_cavity.sh</span></code>. Then,
the command below would submit the batch job to slurm:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>/home/user/2d_driven_cavity.sh
</pre></div>
</div>
</section>
<section id="slurm-environmental-variables">
<span id="slurm-env-vars"></span><h1>Slurm environmental variables<a class="headerlink" href="#slurm-environmental-variables" title="Link to this heading"></a></h1>
<p>When launching a job, slurm retains information about the servers allocated, cores assigned,
working directory from which the job was launched, among other things. Slurm passes
this information to the job via environmental variables. The table below shows some variables
commonly used within the shell scripts of batch jobs.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Commonly used Slurm environmental variables</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 28%" />
<col style="width: 44%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Slurm Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>$SLURM_CPUS_ON_NODE</p></th>
<td><p>Number of total CPUs allocated on node</p></td>
<td><p>8,3</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_CPUS_PER_TASK</p></th>
<td><p>Number of cores per task. I.e., the value given to the <code class="docutils literal notranslate"><span class="pre">-cpus-per-task</span></code> or <code class="docutils literal notranslate"><span class="pre">-c</span></code> sbatch options. Not set unless one of those options given.</p></td>
<td><p>8,3</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_JOB_ID</p></th>
<td><p>Job ID</p></td>
<td><p>5741192</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_JOB_NAME</p></th>
<td><p>Job Name</p></td>
<td><p>myjob</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_JOB_NODELIST</p></th>
<td><p>Nodes assigned to job</p></td>
<td><p>phineas-c[01-03], phineas-c[01,03]</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_JOB_NUM_NODES</p></th>
<td><p>Number of nodes allocated to job</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_LOCALID</p></th>
<td><p>Index to core running on within node</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_NODEID</p></th>
<td><p>Index to node running on relative to nodes assigned to job</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_NNODES</p></th>
<td><p>Deprecated. Same as SLURM_JOB_NUM_NODES</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_NTASKS</p></th>
<td><p>Total number of tasks. Number of total cores is given by SLURM_NTASKS times SLURM_CPUS_PER_TASK</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_PROCID</p></th>
<td><p>Index of task relative to job</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_SUBMIT_DIR</p></th>
<td><p>Directory from which the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command was invoked</p></td>
<td><p>/home/user/wdir</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SLURM_SUBMIT_HOST</p></th>
<td><p>Hostname of the computer from which the command <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> was invoked.</p></td>
<td><p>phineas-c00</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SLURM_TASKS_PER_NODE</p></th>
<td><p>This gives a comma-delimited list of integers representing the task per the node, using the same ordering as in SLURM_JOB_NODELIST. If consecutive nodes have the same task count, the integer will be followed by ‘(xN)’, so the example value is for 2 tasks on the first three nodes and 1 task on the fourth node.</p></td>
<td><p>2(x3),1</p></td>
</tr>
</tbody>
</table>
<p>For more comprehensive details, please consult
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html#SECTION_OUTPUT-ENVIRONMENT-VARIABLES">Section “OUTPUT ENVIRONMENT VARIABLES” of Slurm’s sbatch manual</a>.</p>
</section>
<section id="other-environmental-variables">
<h1>Other environmental variables<a class="headerlink" href="#other-environmental-variables" title="Link to this heading"></a></h1>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">Commonly used Slurm environmental variables</span><a class="headerlink" href="#id4" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>$TMP</p></th>
<td><p>Path to a job’s designated temporary storage in Disk. This folder is isolated from other jobs.</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>$SCRATCH</p></th>
<td><p>Path to a job’s designated space for storage of intermediate results generated by a simulation.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>$SHM</p></th>
<td><p>Path to a job’s designated temporary storage in RAM. This folder is isolated from other jobs.</p></td>
</tr>
</tbody>
</table>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="interactive_jobs.html" class="btn btn-neutral float-left" title="Starting an interactive job" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../software/index.html" class="btn btn-neutral float-right" title="Ansys" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Speed Technology Solutions.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>